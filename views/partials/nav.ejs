<div
  class="fixed z-50 top-0 w-full h-14 sm:h-16 flex items-center justify-between px-3 sm:px-6 bg-gray-900 text-white backdrop-blur-sm border-b border-gray-700">
  <!-- ... existing mobile menu button and navigation links ... -->



  <!-- Right Side (Logo and Auth/Icons) -->
  <div class="flex items-center justify-between w-full">
    <!-- Logo on the left -->
    <div class="flex items-center">
      <img src="/images/logo.png" alt="logo"
        class="h-12 sm:h-14 md:h-16 lg:h-20 w-auto object-contain transition-all duration-300"
        style="max-height: 5rem;" />
    </div>

    <div class="lg:hidden">
      <button id="menu-toggle" class="p-1.5 sm:p-2 rounded-lg text-slate-700 hover:bg-gray-100/80 transition-colors">
        <i class="fa-solid fa-bars text-xl sm:text-2xl"></i>
      </button>
    </div>

    <!-- Left Side (Nav Links) -->  
    <nav class="hidden lg:flex items-center space-x-8">
      <a href="/home" class="text-sm font-medium text-slate-700 hover:text-black hover:underline transition-colors duration-300 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
        Home
      </a>
      <a href="/shop" class="text-sm font-medium text-slate-700 hover:text-black hover:underline transition-colors duration-300 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
        Shop
      </a>
      <a href="#" class="text-sm font-medium text-slate-700 hover:text-black hover:underline transition-colors duration-300 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
        Contact
      </a>
      <a href="/about" class="text-sm font-medium text-slate-700 hover:text-black hover:underline transition-colors duration-300 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        About
      </a>
    </nav>
    <!-- Auth Buttons or Icons based on session -->
    <div class="flex items-center justify-end" id="loginButtons">
      <!-- Auth Buttons (shown when not authenticated) -->
      <div class="flex items-center space-x-2" id="authButtons">
        <a href="/user/login"
          class="text-xs font-medium text-white hover:text-gray-300 px-2.5 py-1 rounded-md transition-colors inline-flex items-center">
          <i class="fa-solid fa-sign-in-alt mr-1.5"></i>Login
        </a>

        <a href="/user/signup"
          class="text-xs font-medium text-white bg-emerald-600 hover:bg-emerald-700 px-2.5 py-1 rounded-md transition-colors inline-flex items-center">
          <i class="fa-solid fa-user-plus mr-1.5"></i>Sign Up
        </a>
      </div>
      <!-- Icons (shown when authenticated) -->
      <div class="flex items-center space-x-2 sm:space-x-6" id="userIcons">
        <a href="/wishlist" class="p-1.5 sm:p-2 text-white hover:text-gray-300 transition-colors">
          <i class="fa-regular fa-heart text-lg sm:text-xl"></i>
        </a>
        <a href="/profile" class="p-1.5 sm:p-2 text-white hover:text-gray-300 transition-colors">
          <i class="fa-regular fa-user text-lg sm:text-xl"></i>
        </a>
        <a href="/cart" class="p-1.5 sm:p-2 text-white hover:text-gray-300 transition-colors relative">
          <i class="fa-solid fa-cart-shopping text-lg sm:text-xl"></i>
          <% if (locals.cartCount && cartCount> 0) { %>
            <span
              class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full">
              <%= cartCount> 9 ? '9+' : cartCount %>
            </span>
            <% } %>
        </a>
        <button onclick="handleLogout()" class="p-1.5 sm:p-2 text-white hover:text-gray-300 transition-colors">
          <i class="fa-solid fa-sign-out-alt text-lg sm:text-xl"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<div id="mobile-menu" class="fixed inset-0 bg-black/20 backdrop-blur-sm hidden lg:hidden z-40" aria-hidden="true">
  <!-- Mobile Menu Panel -->
  <div
    class="fixed top-14 sm:top-16 left-0 w-full max-w-sm bg-white border-r border-gray-200 h-screen transform transition-transform duration-300 ease-in-out">
    <nav class="flex flex-col p-4 space-y-2">
      <a href="/home"
        class="p-3 text-sm font-medium text-slate-700 hover:bg-gray-50 rounded-lg transition-colors">Home</a>
      <a href="/shop"
        class="p-3 text-sm font-medium text-slate-700 hover:bg-gray-50 rounded-lg transition-colors">Shop</a>
      <a href="#"
        class="p-3 text-sm font-medium text-slate-700 hover:bg-gray-50 rounded-lg transition-colors">Contact</a>
      <a href="/about" class="p-3 text-sm font-medium text-slate-700 hover:bg-gray-50 rounded-lg transition-colors">About</a>
    </nav>
  </div>
</div>

<!-- Mobile Menu Overlay -->
<div id="mobile-menu" class="fixed inset-0 bg-black/20 backdrop-blur-sm hidden lg:hidden z-40" aria-hidden="true">
  <div
    class="fixed top-14 sm:top-16 left-0 w-full max-w-sm bg-white border-r border-gray-200 h-screen transform transition-transform duration-300 ease-in-out">
    <nav class="flex flex-col p-4 space-y-2">
      <!-- ... existing navigation links ... -->

      <% if (!locals.user) { %>
        <!-- Auth Buttons in Mobile Menu -->
        <div class="border-t border-gray-200 mt-2 pt-2" id="mobileAuthButtons">
          <a href="/user/login"
            class="p-3 text-sm font-medium text-gray-900 hover:bg-gray-50 rounded-lg transition-colors flex items-center">
            <i class="fa-solid fa-sign-in-alt mr-2"></i>Login
          </a>
          <a href="/user/signup"
            class="p-3 mt-1 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition-colors flex items-center justify-center">
            <i class="fa-solid fa-user-plus mr-2"></i>Sign Up
          </a>
        </div>
        <% } else { %>
          <!-- Mobile Icons Menu -->
          <div class="border-t border-gray-200 mt-2 pt-2" id="mobileUserIcons">
            <a href="/wishlist"
              class="p-3 text-sm font-medium text-gray-900 hover:bg-gray-50 rounded-lg transition-colors flex items-center">
              <i class="fa-regular fa-heart mr-2"></i>Wishlist
            </a>
            <a href="/profile"
              class="p-3 text-sm font-medium text-gray-900 hover:bg-gray-50 rounded-lg transition-colors flex items-center">
              <i class="fa-regular fa-user mr-2"></i>Profile
            </a>
            <a href="/cart"
              class="p-3 text-sm font-medium text-gray-900 hover:bg-gray-50 rounded-lg transition-colors flex items-center">
              <i class="fa-solid fa-cart-shopping mr-2"></i>Cart
              <% if (locals.cartCount && cartCount> 0) { %>
                <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">
                  <%= cartCount> 9 ? '9+' : cartCount %>
                </span>
                <% } %>
            </a>
            <button onclick="handleLogout()"
              class="w-full p-3 text-sm font-medium text-gray-900 hover:bg-gray-50 rounded-lg transition-colors flex items-center">
              <i class="fa-solid fa-sign-out-alt mr-2"></i>Logout
            </button>
          </div>
          <% } %>



            <!-- //button // -->

            <button onclick="handleLogout()"
              class="text-xs font-medium text-white hover:text-gray-300 px-2.5 py-1 rounded-md transition-colors inline-flex items-center">
              <i class="fa-solid fa-sign-out-alt mr-1.5"></i>Logout
            </button>

            <!-- end -->

    </nav>
  </div>
</div>

<script>
  const menuToggle = document.getElementById("menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");

  let userHasSession = false;

  // document.addEventListener("DOMContentLoaded", function () {
  //   function getCookie(name) {
  //     let cookies = document.cookie.split('; ');
  //     console.log("getting cookie", cookies)
  //     for (let cookie of cookies) {
  //       let [key, value] = cookie.split('=');
  //       if (key === name) {
  //         return value;
  //       }
  //     }
  //     return null;
  //   }

  //   let userSession = getCookie("connect.sid");
  //   console.log("Sessionnnnnnnnn", userSession);


  //   if (false) { //stopped herre
  //     document.getElementById("authButtons").style.display = "none";  // Hide login/signup
  //     document.getElementById("userIcons").style.display = "flex";   // Show user icons/logout
  //   } else {
  //     document.getElementById("authButtons").style.display = "flex";  // Show login/signup
  //     document.getElementById("userIcons").style.display = "none";   // Hide user icons/logout
  //   }
  // });

  document.addEventListener("DOMContentLoaded", async function () {
    try {
      const response = await fetch('/check-session');
      const data = await response.json();
      console.log("Session Data:", data);

      if (data.isLoggedIn) {
        document.getElementById("authButtons").style.display = "none";  // Hide login/signup
        document.getElementById("userIcons").style.display = "flex";    // Show user icons
      } else {
        document.getElementById("authButtons").style.display = "flex";  // Show login/signup
        document.getElementById("userIcons").style.display = "none";    // Hide user icons
      }
    } catch (error) {
      console.error("Error checking session:", error);
    }
  });





  let isMenuOpen = false;

  // Handle logout
  async function handleLogout() {
    try {
      const response = await fetch('/user/logout', {
        method: 'POST',
        credentials: 'same-origin'
      });

      if (response.ok) {
        window.location.href = '/user/login';
      } else {
        console.error('Logout failed');
      }
    } catch (error) {
      console.error('Logout error:', error);
    }
  }

  // Mobile menu toggle
  menuToggle.addEventListener("click", () => {
    isMenuOpen = !isMenuOpen;
    mobileMenu.classList.toggle("hidden");
    document.body.classList.toggle("overflow-hidden");

    const menuIcon = menuToggle.querySelector('i');
    if (isMenuOpen) {
      menuIcon.classList.remove('fa-bars');
      menuIcon.classList.add('fa-xmark');
    } else {
      menuIcon.classList.remove('fa-xmark');
      menuIcon.classList.add('fa-bars');
    }
  });

  // Close menu when clicking outside
  mobileMenu.addEventListener('click', (event) => {
    if (event.target === mobileMenu) {
      mobileMenu.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
      isMenuOpen = false;
      const menuIcon = menuToggle.querySelector('i');
      menuIcon.classList.remove('fa-xmark');
      menuIcon.classList.add('fa-bars');
    }
  });
</script>